---
title: nas项目总结
date: 2018-03-03 18:08:09
tags: work
---

### nas项目

本人主要负责系统OTA的固件升级，修改厂测，集成CDN，格式化硬盘功能，在其中遇见很多问题，也一一解决了，先总结如下：

1. 盒子带着硬盘上电启动，无法给出格式化提示

> 解决方法：由于硬盘插入时间过早，已经接收不到插入事件，只能通过在系统启动后扫描当前usb挂载情况。有的硬盘较大, 挂载时间较长，在apk启动后并没有检测到硬盘mount的状态，后通过延时启动sdk来保障硬盘状态是挂载好的时候进行扫描

2. 格式化在sdk操作的时候，提示没有权限

> 解决方法：按照之前定的需求，sdk要完成硬盘格式化功能，格式化脚本选择系统的mkntfs.cpp，sdk代码为System(“mkntfs /dev/sda”), 运行在系统后，提示无权限执行，（1）尝试用Process.Runtime(“su”)提高权限，无效；（2）尝试给予操作的目录为system用户组，无效；（3）改为由java层通过mountService执行format

3. App间跨进程通信时机

> 解决方法：使用AIDL做接口